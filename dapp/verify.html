<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">

</head>

<body>

    <div>
        <img src="/images/momentix-logo.webp" />
    </div>

    <h2>Scan a QR Code</h2>

    <video id="scanner" style="width: 250px;"></video>

    <div id="qrdata"></div>

    <script src="/scripts/qr-scanner.umd.min.js"></script>
    <script>
        var videoElem = document.getElementById('scanner');
        var dataElem = document.getElementById('qrdata');
        const qrScanner = new QrScanner(
            videoElem,
            async result => {
                if ("data" in result) {
                    qrScanner.stop();
                    console.log('decoded qr code:', result.data);
                    dataElem.innerText = result.data;
                    var d = JSON.parse(result.data);
                    console.log(d.address);
                    const verifyURL = `https://api.momentix.xyz/verify?address=${d.address}&event=${d.event}&tokenId=${d.tokenId}&hash=${d.hash}`;
                    console.log(verifyURL);
                    const response = await fetch(verifyURL);
                    const responseText = await response.json();
                    console.log(responseText);
                    if ("valid" in responseText) {
                        if (responseText.valid == true) {
                            dataElem.innerText = "VALID TICKET";
                        }
                    }
                    if ("error" in responseText) {
                            dataElem.innerText = "INVALID TICKET: " + responseText.error;
                    }
                }
            },
            { /* your options or returnDetailedScanResult: true if you're not specifying any other options */ },
        );
        qrScanner.start();
    </script>
</body>

</html>